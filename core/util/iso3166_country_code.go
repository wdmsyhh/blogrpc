package util

import (
	"fmt"
	"strings"
)

// 注意顺序，从大到小。
var country_codes = []string{"6723", "1907", "1876", "1868", "1809", "1808", "1787", "1784", "1767", "1758", "1721", "1684", "1671", "1664", "1649", "1473", "1441", "1345", "1340", "1284", "1268", "1264", "1246", "1242", "998", "996", "995", "994", "993", "992", "977", "976", "975", "974", "973", "972", "971", "968", "967", "966", "965", "964", "963", "962", "961", "960", "886", "880", "856", "855", "853", "852", "692", "691", "690", "689", "688", "687", "686", "685", "684", "683", "682", "680", "679", "678", "677", "676", "675", "674", "673", "670", "599", "598", "597", "596", "595", "594", "593", "592", "591", "590", "509", "508", "507", "506", "505", "504", "503", "502", "501", "500", "423", "421", "420", "389", "387", "386", "385", "382", "381", "380", "378", "377", "376", "375", "374", "373", "372", "371", "370", "359", "358", "357", "356", "355", "354", "353", "352", "351", "350", "299", "298", "297", "291", "290", "269", "268", "267", "266", "265", "264", "263", "262", "261", "260", "259", "258", "257", "256", "255", "254", "253", "252", "251", "250", "249", "248", "247", "245", "244", "242", "241", "240", "239", "238", "237", "236", "235", "234", "233", "232", "231",
	"230", "229", "228", "227", "226", "225", "224", "223", "222", "221", "220", "218", "216", "213", "212", "98", "95", "94", "93", "92", "91", "90", "86", "85", "84", "82", "81", "66", "65", "64", "63", "62", "61", "60", "58", "57", "56", "55", "54", "53", "52", "51", "49", "48", "47", "46", "45", "44", "43", "41", "40", "39", "36", "34", "33", "32", "31", "30", "27", "20", "7", "1"}

func GetPhoneCountryCode(phone string) string {
	for _, code := range country_codes {
		if strings.HasPrefix(phone, code) {
			return code
		}
	}

	return ""
}

// 0085256374288 的国际号转成群脉识别的格式 +(countryCode)-(Number)
func ToMaiPhone(phone string) (string, error) {
	phone = strings.TrimLeft(phone, "00")
	code := GetPhoneCountryCode(phone)
	if code == "" {
		return "", fmt.Errorf("Cannot find country code for phone %s", phone)
	}
	// 中国号码特殊处理，不带 + -
	if code == "86" {
		return strings.TrimLeft(phone, code), nil
	}

	return fmt.Sprintf("+%s-%s", code, strings.TrimLeft(phone, code)), nil
}
